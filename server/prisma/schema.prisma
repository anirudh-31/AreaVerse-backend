generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id                String   @id @default(uuid())
  username          String   @unique
  first_name        String
  last_name         String
  email             String   @unique
  profession        String?
  dateOfBirth       DateTime?
  isVerified        Boolean  @default(false)
  verificationToken String?
  verificationCode  String?
  resetToken        String?
  resetTokenExpiry  DateTime?
  role              Role     @default(USER)
  authProvider      AuthType @default(LOCAL)
  passwordHash      String?
  neighborhoodId    String?  
  neighborhood      neighborhood? @relation(fields: [neighborhoodId], references: [id])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  refreshTokens     refreshtoken[]
  posts             post[]
  postEdits         posthistory[]
  followers         follow[]      @relation("UserFollowers")
  following         follow[]      @relation("UserFollowing")
  likes             like[]
}

model neighborhood {
  id                   String   @id @default(uuid())
  name                 String   @unique
  city                 String
  state                String
  sentimentScore       Float    @default(0)
  electedRepresentative String?
  users                user[]
  country              String   
}

model refreshtoken {
  id          Int      @id @default(autoincrement())
  token       String   @unique
  user        user     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  revoked     Boolean  @default(false)

  @@index([userId])
}

model post {
  id          String     @id @default(uuid())
  type        PostType
  title       String
  severity    Severity?
  description String
  category    String
  status      PostStatus @default(REPORTED)
  feedback    String?
  user_id     String
  user        user       @relation(fields: [user_id], references: [id])
  images      image[]
  histories   posthistory[]
  likes       like[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model image {
  id     String @id @default(uuid())
  url    String 
  postId String
  post   post   @relation(fields: [postId], references: [id])
}

model posthistory {
  id        String     @id @default(uuid())
  postId    String
  post      post       @relation(fields: [postId], references: [id])
  status    PostStatus
  changedBy String     
  user      user       @relation(fields: [changedBy], references: [id])
  message   String?
  createdAt DateTime   @default(now())
}

model follow{
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  follower    user     @relation("UserFollowing", fields: [followerId], references: [id])
  following   user     @relation("UserFollowers", fields: [followingId], references: [id])
  createdAt   DateTime @default(now())
  @@unique([followerId, followingId])
}

model like{
  id        String   @id @default(uuid())
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  post      post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  createdAt DateTime @default(now())

  @@unique([userId, postId])
}
enum Severity{
  LOW
  MEDIUM
  CRITICAL
}

enum PostType {
  ISSUE
  QUERY
  GENERAL
}
enum PostStatus {
  REPORTED
  UNDER_REVIEW
  APPROVED
  MORE_INFO_NEEDED
  REJECTED
  UPDATED
}

enum Role {
  ADMIN
  AGENT
  USER
}

enum AuthType {
  LOCAL
  GOOGLE
  FACEBOOK
}
